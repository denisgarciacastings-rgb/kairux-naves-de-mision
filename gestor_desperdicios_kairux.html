<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H-09: El Gestor de Desperdicios (WASTE) - Kairux</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --dark-gradient: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            --glass-bg: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.15);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-muted: rgba(255, 255, 255, 0.5);
            --success: #00d4aa;
            --warning: #ffb74d;
            --danger: #ff5252;
            --info: #42a5f5;
            --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.8);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--dark-gradient);
            color: var(--text-primary);
            overflow-x: hidden;
            min-height: 100vh;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 25% 25%, rgba(229, 62, 62, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(255, 140, 0, 0.2) 0%, transparent 50%);
            animation: wasteShift 25s ease infinite;
            z-index: -1;
        }

        @keyframes wasteShift {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .header {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            padding: 2rem;
            text-align: center;
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--danger), var(--warning), var(--success), transparent);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--danger) 0%, var(--warning) 50%, var(--success) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .container {
            display: grid;
            grid-template-columns: 400px 1fr 350px;
            height: calc(100vh - 120px);
            gap: 1.5rem;
            padding: 1.5rem;
        }

        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
        }

        .glass-panel:hover {
            background: rgba(255, 255, 255, 0.12);
        }

        .panel-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .gemba-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 1.5rem;
            overflow-y: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .timwoods-grid {
            display: grid;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .waste-category {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .waste-category:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .waste-category.selected {
            border-color: var(--warning);
            background: rgba(255, 183, 77, 0.1);
        }

        .waste-category h4 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .waste-category p {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--warning);
            box-shadow: 0 0 0 3px rgba(255, 183, 77, 0.1);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--warning), #e67e22);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 183, 77, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #27ae60);
            color: white;
        }

        .analysis-canvas {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
        }

        .canvas-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.05);
        }

        .canvas-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .view-tabs {
            display: flex;
            gap: 0.5rem;
        }

        .tab {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: var(--warning);
            color: white;
        }

        .canvas-content {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
        }

        .priority-matrix {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 1rem;
            height: 400px;
            margin: 2rem 0;
            position: relative;
        }

        .matrix-quadrant {
            background: rgba(255, 255, 255, 0.05);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            position: relative;
            min-height: 180px;
        }

        .quadrant-high-high {
            border-color: var(--danger);
            background: rgba(229, 62, 62, 0.1);
        }

        .quadrant-high-low {
            border-color: var(--warning);
            background: rgba(255, 183, 77, 0.1);
        }

        .quadrant-low-high {
            border-color: var(--info);
            background: rgba(66, 165, 245, 0.1);
        }

        .quadrant-low-low {
            border-color: var(--success);
            background: rgba(56, 161, 105, 0.1);
        }

        .quadrant-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .waste-item {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            padding: 0.75rem;
            margin: 0.5rem 0;
            cursor: move;
            transition: all 0.3s ease;
        }

        .waste-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.02);
        }

        .waste-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }

        .waste-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .waste-impact {
            font-size: 0.8rem;
            font-weight: 600;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
        }

        .impact-high {
            background: rgba(229, 62, 62, 0.2);
            color: var(--danger);
        }

        .impact-medium {
            background: rgba(255, 183, 77, 0.2);
            color: var(--warning);
        }

        .impact-low {
            background: rgba(56, 161, 105, 0.2);
            color: var(--success);
        }

        .waste-details {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .actions-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 1.5rem;
            overflow-y: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .roi-calculator {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .roi-result {
            text-align: center;
            padding: 1rem;
            background: var(--glass-bg);
            border-radius: 10px;
            margin-top: 1rem;
        }

        .roi-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--success);
            margin-bottom: 0.5rem;
        }

        .roi-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .action-plan {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .action-step {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.75rem;
            border-radius: 8px;
            margin: 0.5rem 0;
            border-left: 4px solid var(--warning);
        }

        .action-step h5 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .action-step p {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .waste-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 1rem 0;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr 1fr;
                grid-template-rows: auto auto;
            }
            
            .gemba-panel {
                grid-column: 1 / 3;
            }
        }

        .onboarding-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .onboarding-content {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2rem;
            max-width: 600px;
            text-align: center;
        }

        .timwoods-guide {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .timwoods-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 10px;
            text-align: left;
        }

        .timwoods-item h4 {
            color: var(--warning);
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .timwoods-item p {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîç El Gestor de Desperdicios (WASTE)</h1>
        <p>Identificaci√≥n inteligente basada en metodolog√≠a Lean TIMWOODS</p>
    </div>

    <div class="container">
        <div class="gemba-panel">
            <div class="glass-panel">
                <div class="panel-title">
                    üö∂‚Äç‚ôÇÔ∏è Gemba Walk Digital
                </div>
                
                <div class="timwoods-grid">
                    <div class="waste-category" data-type="transport" onclick="selectWasteType('transport')">
                        <h4>üöõ T - Transporte</h4>
                        <p>Movimiento innecesario de materiales o informaci√≥n</p>
                    </div>
                    <div class="waste-category" data-type="inventory" onclick="selectWasteType('inventory')">
                        <h4>üì¶ I - Inventario</h4>
                        <p>Exceso de stock o recursos no utilizados</p>
                    </div>
                    <div class="waste-category" data-type="motion" onclick="selectWasteType('motion')">
                        <h4>üèÉ‚Äç‚ôÇÔ∏è M - Movimiento</h4>
                        <p>Movimiento ineficiente de personas o equipo</p>
                    </div>
                    <div class="waste-category" data-type="waiting" onclick="selectWasteType('waiting')">
                        <h4>‚è∞ W - Espera</h4>
                        <p>Tiempo perdido esperando recursos o informaci√≥n</p>
                    </div>
                    <div class="waste-category" data-type="overproduction" onclick="selectWasteType('overproduction')">
                        <h4>üè≠ O - Sobreproducci√≥n</h4>
                        <p>Producir m√°s de lo que demanda el cliente</p>
                    </div>
                    <div class="waste-category" data-type="overprocessing" onclick="selectWasteType('overprocessing')">
                        <h4>‚öôÔ∏è O - Sobre-procesamiento</h4>
                        <p>Hacer m√°s trabajo del necesario</p>
                    </div>
                    <div class="waste-category" data-type="defects" onclick="selectWasteType('defects')">
                        <h4>‚ùå D - Defectos</h4>
                        <p>Errores que requieren retrabajo o correcci√≥n</p>
                    </div>
                    <div class="waste-category" data-type="skills" onclick="selectWasteType('skills')">
                        <h4>üß† S - Skills</h4>
                        <p>Talento y habilidades subutilizados</p>
                    </div>
                </div>
            </div>

            <div class="glass-panel">
                <div class="panel-title">
                    ‚ûï Registrar Desperdicio
                </div>
                
                <div class="form-group">
                    <label class="form-label">Tipo Seleccionado</label>
                    <input type="text" class="form-input" id="wasteTypeSelected" readonly placeholder="Selecciona un tipo TIMWOODS arriba">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Descripci√≥n del Desperdicio</label>
                    <textarea class="form-textarea" id="wasteDescription" placeholder="Describe espec√≠ficamente qu√© observaste..." rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Proceso Afectado</label>
                    <select class="form-select" id="affectedProcess">
                        <option value="">Seleccionar proceso...</option>
                        <option value="atencion_cliente">Atenci√≥n al Cliente</option>
                        <option value="produccion">Producci√≥n</option>
                        <option value="ventas">Ventas</option>
                        <option value="logistica">Log√≠stica</option>
                        <option value="administracion">Administraci√≥n</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Frecuencia (por semana)</label>
                    <select class="form-select" id="wasteFrequency">
                        <option value="1">1 vez por semana</option>
                        <option value="3">2-3 veces por semana</option>
                        <option value="7">Diariamente</option>
                        <option value="14">Varias veces al d√≠a</option>
                        <option value="30">Constantemente</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Tiempo Perdido (minutos por ocurrencia)</label>
                    <input type="number" class="form-input" id="timeLost" placeholder="15" min="1">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Costo Estimado (‚Ç° por ocurrencia)</label>
                    <input type="number" class="form-input" id="costEstimated" placeholder="5000" min="0">
                </div>
                
                <button class="btn btn-primary" onclick="addWasteItem()">
                    üîç Registrar Desperdicio
                </button>
            </div>
        </div>

        <div class="analysis-canvas">
            <div class="canvas-header">
                <div class="canvas-title">üìä Matriz de Priorizaci√≥n de Desperdicios</div>
                <div class="view-tabs">
                    <div class="tab active" onclick="switchView('matrix')">Matriz</div>
                    <div class="tab" onclick="switchView('list')">Lista</div>
                    <div class="tab" onclick="switchView('trends')">Tendencias</div>
                </div>
            </div>
            
            <div class="canvas-content">
                <div id="matrixView" class="view-content">
                    <div class="priority-matrix">
                        <div class="matrix-quadrant quadrant-high-high" id="quadrant-high-high">
                            <div class="quadrant-title">üö® CR√çTICO - Atender Inmediatamente</div>
                            <small>Alto Impacto + Alta Frecuencia</small>
                        </div>
                        <div class="matrix-quadrant quadrant-high-low" id="quadrant-high-low">
                            <div class="quadrant-title">‚ö†Ô∏è IMPORTANTE - Planificar Soluci√≥n</div>
                            <small>Alto Impacto + Baja Frecuencia</small>
                        </div>
                        <div class="matrix-quadrant quadrant-low-high" id="quadrant-low-high">
                            <div class="quadrant-title">üìã MONITOREAR - Quick Wins</div>
                            <small>Bajo Impacto + Alta Frecuencia</small>
                        </div>
                        <div class="matrix-quadrant quadrant-low-low" id="quadrant-low-low">
                            <div class="quadrant-title">‚úÖ BAJO - Revisar Peri√≥dicamente</div>
                            <small>Bajo Impacto + Baja Frecuencia</small>
                        </div>
                    </div>
                    
                    <div style="text-align: center; color: var(--text-muted); margin-top: 1rem;">
                        <p>üí° Arrastra los desperdicios entre cuadrantes para reclasificar su prioridad</p>
                    </div>
                </div>

                <div id="listView" class="view-content" style="display: none;">
                    <div class="waste-stats">
                        <div class="stat-card">
                            <div class="stat-value" id="totalWastes">0</div>
                            <div class="stat-label">Desperdicios Detectados</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalCostWeekly">‚Ç°0</div>
                            <div class="stat-label">Costo Semanal</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalTimeWeekly">0h</div>
                            <div class="stat-label">Tiempo Perdido/Semana</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="efficiencyLoss">0%</div>
                            <div class="stat-label">P√©rdida Eficiencia</div>
                        </div>
                    </div>
                    
                    <div id="wasteListContainer">
                        <div style="text-align: center; color: var(--text-muted); padding: 2rem;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">üîç</div>
                            <h3>No hay desperdicios registrados</h3>
                            <p>Comienza tu Gemba Walk digital para identificar oportunidades de mejora</p>
                        </div>
                    </div>
                </div>

                <div id="trendsView" class="view-content" style="display: none;">
                    <div class="timwoods-breakdown">
                        <h4>üìä Distribuci√≥n por Tipo TIMWOODS</h4>
                        <div id="timwoodsChart" style="height: 300px; background: rgba(255,255,255,0.1); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: var(--text-muted); margin: 1rem 0;">
                            üìà Gr√°fico de distribuci√≥n aparecer√° aqu√≠
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="actions-panel">
            <div class="glass-panel">
                <div class="panel-title">
                    üéØ Desperdicio Seleccionado
                </div>
                <div id="selectedWasteDetails" style="text-align: center; color: var(--text-muted); padding: 1rem;">
                    Selecciona un desperdicio de la matriz para ver detalles y generar plan de acci√≥n
                </div>
            </div>

            <div class="glass-panel">
                <div class="panel-title">
                    üí∞ Calculadora de ROI
                </div>
                <div class="roi-calculator">
                    <div class="form-group">
                        <label class="form-label">Costo de Implementaci√≥n (‚Ç°)</label>
                        <input type="number" class="form-input" id="implementationCost" placeholder="50000" min="0">
                    </div>
                    <div class="form-group">
                        <label class="form-label">% de Reducci√≥n Esperada</label>
                        <input type="range" class="form-input" id="reductionPercentage" min="10" max="100" value="80">
                        <div style="text-align: center; margin-top: 0.5rem;">
                            <span id="reductionValue">80%</span>
                        </div>
                    </div>
                    <div class="roi-result">
                        <div class="roi-value" id="calculatedROI">0%</div>
                        <div class="roi-label">ROI Estimado en 12 meses</div>
                    </div>
                </div>
            </div>

            <div class="glass-panel">
                <div class="panel-title">
                    üöÄ Plan de Acci√≥n
                </div>
                <div class="action-plan" id="actionPlanContainer">
                    <div style="text-align: center; color: var(--text-muted); padding: 1rem;">
                        Selecciona un desperdicio para generar plan de acci√≥n autom√°tico
                    </div>
                </div>
                <div style="display: none; gap: 0.5rem;" id="actionPlanActions">
                    <button class="btn btn-success" onclick="exportToTaskManager()">
                        üìã Enviar a Gestor de Tareas
                    </button>
                </div>
            </div>

            <div class="glass-panel">
                <div class="panel-title">
                    üì° Exportar & Sincronizar
                </div>
                <div style="display: grid; gap: 0.75rem;">
                    <button class="btn btn-primary" onclick="syncWithKairux()">
                        üéØ Sync Puente de Mando
                    </button>
                    <button class="btn btn-success" onclick="generateWasteReport()">
                        üìÑ Reporte de Desperdicios
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="onboarding-overlay" id="onboardingOverlay">
        <div class="onboarding-content">
            <h3>üîç ¬°Bienvenido al Gestor de Desperdicios!</h3>
            <p style="margin: 1rem 0;">Identifica y elimina los 8 desperdicios de Lean Manufacturing usando metodolog√≠a TIMWOODS</p>
            
            <div class="timwoods-guide">
                <div class="timwoods-item">
                    <h4>üöõ Transport</h4>
                    <p>Movimiento innecesario de materiales</p>
                </div>
                <div class="timwoods-item">
                    <h4>üì¶ Inventory</h4>
                    <p>Exceso de stock o recursos</p>
                </div>
                <div class="timwoods-item">
                    <h4>üèÉ‚Äç‚ôÇÔ∏è Motion</h4>
                    <p>Movimiento ineficiente de personas</p>
                </div>
                <div class="timwoods-item">
                    <h4>‚è∞ Waiting</h4>
                    <p>Tiempo perdido esperando</p>
                </div>
                <div class="timwoods-item">
                    <h4>üè≠ Overproduction</h4>
                    <p>Producir m√°s de lo necesario</p>
                </div>
                <div class="timwoods-item">
                    <h4>‚öôÔ∏è Over-processing</h4>
                    <p>Trabajo excesivo o innecesario</p>
                </div>
                <div class="timwoods-item">
                    <h4>‚ùå Defects</h4>
                    <p>Errores que requieren retrabajo</p>
                </div>
                <div class="timwoods-item">
                    <h4>üß† Skills</h4>
                    <p>Talento subutilizado</p>
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="closeOnboarding()">
                üöÄ ¬°Comenzar Gemba Walk!
            </button>
        </div>
    </div>

    <script>
        let wasteItems = [];
        let selectedWasteType = null;
        let selectedWaste = null;
        let currentView = 'matrix';

        const actionTemplates = {
            transport: [
                { step: "Mapear flujos actuales", description: "Documentar todos los movimientos de materiales" },
                { step: "Identificar movimientos innecesarios", description: "Marcar transportes que no agregan valor" },
                { step: "Redise√±ar layout", description: "Reorganizar espacios para minimizar distancias" }
            ],
            inventory: [
                { step: "Auditar inventario actual", description: "Revisar niveles de stock y rotaci√≥n" },
                { step: "Implementar sistema pull", description: "Producir solo lo necesario" },
                { step: "Establecer puntos de reorden", description: "Definir niveles m√≠nimos y m√°ximos" }
            ],
            motion: [
                { step: "An√°lisis de movimientos", description: "Estudiar desplazamientos de personal" },
                { step: "Implementar 5S", description: "Organizar espacios para m√°xima eficiencia" },
                { step: "Capacitar en ergonom√≠a", description: "Ense√±ar movimientos eficientes" }
            ],
            waiting: [
                { step: "Identificar cuellos de botella", description: "Mapear d√≥nde se generan las esperas" },
                { step: "Balancear cargas de trabajo", description: "Redistribuir tareas entre recursos" },
                { step: "Mejorar comunicaci√≥n", description: "Protocolos claros de informaci√≥n" }
            ],
            overproduction: [
                { step: "An√°lisis de demanda real", description: "Estudiar patrones de consumo del cliente" },
                { step: "Implementar producci√≥n pull", description: "Producir solo bajo pedido" },
                { step: "Reducir lotes de producci√≥n", description: "Lotes m√°s peque√±os y frecuentes" }
            ],
            overprocessing: [
                { step: "Definir valor para el cliente", description: "Identificar qu√© realmente valora el cliente" },
                { step: "Eliminar pasos innecesarios", description: "Revisar cada actividad del proceso" },
                { step: "Estandarizar procedimientos", description: "Documentar la forma m√°s eficiente" }
            ],
            defects: [
                { step: "An√°lisis de causa ra√≠z", description: "Usar t√©cnicas como 5 Por Qu√©" },
                { step: "Implementar poka-yoke", description: "Sistemas a prueba de errores" },
                { step: "Mejorar entrenamiento", description: "Capacitar en calidad y procedimientos" }
            ],
            skills: [
                { step: "Mapear habilidades del equipo", description: "Inventario de competencias y talentos" },
                { step: "Identificar gaps de habilidades", description: "Qu√© competencias faltan" },
                { step: "Crear plan de desarrollo", description: "Capacitaci√≥n y cross-training" }
            ]
        };

        document.addEventListener('DOMContentLoaded', function() {
            showOnboarding();
            updateStatistics();
            
            document.getElementById('reductionPercentage').oninput = function() {
                document.getElementById('reductionValue').textContent = this.value + '%';
                if (selectedWaste) calculateROI(selectedWaste);
            };
        });

        function showOnboarding() {
            document.getElementById('onboardingOverlay').style.display = 'flex';
        }

        function closeOnboarding() {
            document.getElementById('onboardingOverlay').style.display = 'none';
        }

        function selectWasteType(type) {
            document.querySelectorAll('.waste-category').forEach(cat => {
                cat.classList.remove('selected');
            });
            
            document.querySelector(`[data-type="${type}"]`).classList.add('selected');
            selectedWasteType = type;
            
            const typeNames = {
                transport: 'üöõ Transporte',
                inventory: 'üì¶ Inventario',
                motion: 'üèÉ‚Äç‚ôÇÔ∏è Movimiento',
                waiting: '‚è∞ Espera',
                overproduction: 'üè≠ Sobreproducci√≥n',
                overprocessing: '‚öôÔ∏è Sobre-procesamiento',
                defects: '‚ùå Defectos',
                skills: 'üß† Skills'
            };
            
            document.getElementById('wasteTypeSelected').value = typeNames[type];
        }

        function addWasteItem() {
            if (!selectedWasteType) {
                alert('‚ö†Ô∏è Selecciona primero un tipo de desperdicio TIMWOODS');
                return;
            }
            
            const description = document.getElementById('wasteDescription').value.trim();
            const process = document.getElementById('affectedProcess').value;
            const frequency = parseInt(document.getElementById('wasteFrequency').value);
            const timeLost = parseInt(document.getElementById('timeLost').value) || 0;
            const cost = parseInt(document.getElementById('costEstimated').value) || 0;
            
            if (!description || !process) {
                alert('‚ö†Ô∏è Completa todos los campos requeridos');
                return;
            }
            
            const weeklyTimeLoss = frequency * timeLost;
            const weeklyCost = frequency * cost;
            const annualCost = weeklyCost * 52;
            
            let priority, quadrant;
            const highImpact = annualCost > 100000 || weeklyTimeLoss > 180;
            const highFrequency = frequency >= 7;
            
            if (highImpact && highFrequency) {
                priority = 'high';
                quadrant = 'high-high';
            } else if (highImpact && !highFrequency) {
                priority = 'medium';
                quadrant = 'high-low';
            } else if (!highImpact && highFrequency) {
                priority = 'medium';
                quadrant = 'low-high';
            } else {
                priority = 'low';
                quadrant = 'low-low';
            }
            
            const wasteItem = {
                id: Date.now(),
                type: selectedWasteType,
                description,
                process,
                frequency,
                timeLost,
                cost,
                weeklyTimeLoss,
                weeklyCost,
                annualCost,
                priority,
                quadrant,
                dateAdded: new Date().toISOString(),
                actionPlan: null,
                status: 'identified'
            };
            
            wasteItems.push(wasteItem);
            createWasteCard(wasteItem);
            clearWasteForm();
            updateStatistics();
            
            showNotification(`üîç Desperdicio ${selectedWasteType.toUpperCase()} detectado y clasificado`, 'success');
        }

        function createWasteCard(waste) {
            const quadrant = document.getElementById(`quadrant-${waste.quadrant}`);
            
            const card = document.createElement('div');
            card.className = 'waste-item';
            card.id = `waste-${waste.id}`;
            card.draggable = true;
            
            let impactClass = 'impact-low';
            if (waste.annualCost > 200000) impactClass = 'impact-high';
            else if (waste.annualCost > 50000) impactClass = 'impact-medium';
            
            const typeEmojis = {
                transport: 'üöõ',
                inventory: 'üì¶',
                motion: 'üèÉ‚Äç‚ôÇÔ∏è',
                waiting: '‚è∞',
                overproduction: 'üè≠',
                overprocessing: '‚öôÔ∏è',
                defects: '‚ùå',
                skills: 'üß†'
            };
            
            card.innerHTML = `
                <div class="waste-item-header">
                    <div class="waste-title">${typeEmojis[waste.type]} ${waste.description}</div>
                    <div class="waste-impact ${impactClass}">‚Ç°${(waste.annualCost/1000).toFixed(0)}K/a√±o</div>
                </div>
                <div class="waste-details">
                    ${waste.process.replace(/_/g, ' ')} ‚Ä¢ ${waste.frequency}x/semana ‚Ä¢ ${waste.weeklyTimeLoss}min/sem
                </div>
            `;
            
            card.addEventListener('click', () => selectWaste(waste));
            card.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', waste.id);
            });
            
            quadrant.appendChild(card);
        }

        function selectWaste(waste) {
            selectedWaste = waste;
            
            document.querySelectorAll('.waste-item').forEach(item => {
                item.style.borderColor = 'var(--glass-border)';
            });
            
            const card = document.getElementById(`waste-${waste.id}`);
            card.style.borderColor = 'var(--warning)';
            
            showWasteDetails(waste);
            calculateROI(waste);
            generateActionPlan(waste);
        }

        function showWasteDetails(waste) {
            const container = document.getElementById('selectedWasteDetails');
            
            const typeNames = {
                transport: 'Transporte',
                inventory: 'Inventario', 
                motion: 'Movimiento',
                waiting: 'Espera',
                overproduction: 'Sobreproducci√≥n',
                overprocessing: 'Sobre-procesamiento',
                defects: 'Defectos',
                skills: 'Skills'
            };
            
            container.innerHTML = `
                <div style="text-align: left;">
                    <h4 style="margin-bottom: 1rem; color: var(--warning);">
                        ${typeNames[waste.type]} - ${waste.description}
                    </h4>
                    <div style="display: grid; gap: 0.5rem; font-size: 0.9rem;">
                        <div><strong>Proceso:</strong> ${waste.process.replace(/_/g, ' ')}</div>
                        <div><strong>Frecuencia:</strong> ${waste.frequency} veces/semana</div>
                        <div><strong>Tiempo Perdido:</strong> ${waste.timeLost} min/ocurrencia</div>
                        <div><strong>Impacto Anual:</strong> ‚Ç°${waste.annualCost.toLocaleString()}</div>
                        <div><strong>Prioridad:</strong> 
                            <span class="waste-impact impact-${waste.priority}">
                                ${waste.priority === 'high' ? 'CR√çTICA' : waste.priority === 'medium' ? 'MEDIA' : 'BAJA'}
                            </span>
                        </div>
                    </div>
                </div>
            `;
        }

        function calculateROI(waste) {
            const implementationCost = parseInt(document.getElementById('implementationCost').value) || 50000;
            const reductionPercentage = parseInt(document.getElementById('reductionPercentage').value) || 80;
            
            const annualSavings = waste.annualCost * (reductionPercentage / 100);
            const roi = ((annualSavings - implementationCost) / implementationCost) * 100;
            
            document.getElementById('calculatedROI').textContent = roi.toFixed(0) + '%';
            document.getElementById('calculatedROI').className = `roi-value ${roi > 100 ? '' : roi > 0 ? '' : ''}`;
        }

        function generateActionPlan(waste) {
            const container = document.getElementById('actionPlanContainer');
            const actions = document.getElementById('actionPlanActions');
            
            if (!actionTemplates[waste.type]) {
                container.innerHTML = '<div style="text-align: center; color: var(--text-muted);">Plan de acci√≥n no disponible</div>';
                actions.style.display = 'none';
                return;
            }
            
            const template = actionTemplates[waste.type];
            
            container.innerHTML = `
                <h4 style="margin-bottom: 1rem; color: var(--success);">Plan de Acci√≥n Generado</h4>
                ${template.map((step, index) => `
                    <div class="action-step">
                        <h5>Paso ${index + 1}: ${step.step}</h5>
                        <p>${step.description}</p>
                    </div>
                `).join('')}
            `;
            
            actions.style.display = 'flex';
            waste.actionPlan = template;
        }

        function switchView(viewName) {
            currentView = viewName;
            
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('.view-content').forEach(view => view.style.display = 'none');
            document.getElementById(viewName + 'View').style.display = 'block';
            
            if (viewName === 'list') {
                updateListView();
            } else if (viewName === 'trends') {
                updateTrendsView();
            }
        }

        function updateListView() {
            const container = document.getElementById('wasteListContainer');
            
            if (wasteItems.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; color: var(--text-muted); padding: 2rem;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üîç</div>
                        <h3>No hay desperdicios registrados</h3>
                        <p>Comienza tu Gemba Walk digital</p>
                    </div>
                `;
                return;
            }
            
            const sortedWastes = [...wasteItems].sort((a, b) => b.annualCost - a.annualCost);
            
            container.innerHTML = sortedWastes.map((waste, index) => {
                const typeEmojis = {
                    transport: 'üöõ', inventory: 'üì¶', motion: 'üèÉ‚Äç‚ôÇÔ∏è', waiting: '‚è∞',
                    overproduction: 'üè≠', overprocessing: '‚öôÔ∏è', defects: '‚ùå', skills: 'üß†'
                };
                
                return `
                    <div class="waste-item" onclick="selectWasteById(${waste.id})" style="cursor: pointer;">
                        <div class="waste-item-header">
                            <div class="waste-title">#${index + 1} ${typeEmojis[waste.type]} ${waste.description}</div>
                            <div class="waste-impact impact-${waste.priority}">‚Ç°${(waste.annualCost/1000).toFixed(0)}K/a√±o</div>
                        </div>
                        <div class="waste-details">${waste.process.replace(/_/g, ' ')} ‚Ä¢ ${waste.frequency}x/semana</div>
                    </div>
                `;
            }).join('');
        }

        function selectWasteById(wasteId) {
            const waste = wasteItems.find(w => w.id === wasteId);
            if (waste) {
                selectWaste(waste);
            }
        }

        function updateTrendsView() {
            const timwoodsCount = {};
            const timwoodsNames = {
                transport: 'Transporte', inventory: 'Inventario', motion: 'Movimiento', waiting: 'Espera',
                overproduction: 'Sobreproducci√≥n', overprocessing: 'Sobre-procesamiento', defects: 'Defectos', skills: 'Skills'
            };
            
            wasteItems.forEach(waste => {
                timwoodsCount[waste.type] = (timwoodsCount[waste.type] || 0) + 1;
            });
            
            const chartDiv = document.getElementById('timwoodsChart');
            if (Object.keys(timwoodsCount).length > 0) {
                chartDiv.innerHTML = Object.entries(timwoodsCount)
                    .sort((a, b) => b[1] - a[1])
                    .map(([type, count]) => `
                        <div style="display: flex; justify-content: space-between; padding: 0.5rem; margin: 0.5rem 0; background: rgba(255,255,255,0.1); border-radius: 6px;">
                            <span>${timwoodsNames[type]}</span>
                            <span style="font-weight: bold; color: var(--warning);">${count}</span>
                        </div>
                    `).join('');
            }
        }

        function updateStatistics() {
            const total = wasteItems.length;
            const totalWeeklyCost = wasteItems.reduce((sum, w) => sum + w.weeklyCost, 0);
            const totalWeeklyTime = wasteItems.reduce((sum, w) => sum + w.weeklyTimeLoss, 0);
            const efficiencyLoss = totalWeeklyTime > 0 ? Math.min((totalWeeklyTime / (40 * 60)) * 100, 100) : 0;
            
            document.getElementById('totalWastes').textContent = total;
            document.getElementById('totalCostWeekly').textContent = `‚Ç°${totalWeeklyCost.toLocaleString()}`;
            document.getElementById('totalTimeWeekly').textContent = `${(totalWeeklyTime / 60).toFixed(1)}h`;
            document.getElementById('efficiencyLoss').textContent = `${efficiencyLoss.toFixed(1)}%`;
        }

        function clearWasteForm() {
            document.getElementById('wasteDescription').value = '';
            document.getElementById('timeLost').value = '';
            document.getElementById('costEstimated').value = '';
            document.getElementById('wasteFrequency').value = '1';
            document.getElementById('affectedProcess').value = '';
            
            document.querySelectorAll('.waste-category').forEach(cat => {
                cat.classList.remove('selected');
            });
            document.getElementById('wasteTypeSelected').value = '';
            selectedWasteType = null;
        }

        function exportToTaskManager() {
            if (!selectedWaste || !selectedWaste.actionPlan) {
                alert('Selecciona un desperdicio y genera su plan de acci√≥n primero');
                return;
            }
            
            showNotification('üìã Plan de acci√≥n enviado al Gestor de Tareas exitosamente', 'success');
            selectedWaste.status = 'planned';
        }

        function syncWithKairux() {
            if (wasteItems.length === 0) {
                alert('No hay desperdicios para sincronizar');
                return;
            }
            
            const kairuxData = {
                timestamp: new Date().toISOString(),
                source: 'gestor_desperdicios',
                summary: {
                    total_desperdicios: wasteItems.length,
                    costo_semanal_total: wasteItems.reduce((sum, w) => sum + w.weeklyCost, 0),
                    tiempo_perdido_semanal: wasteItems.reduce((sum, w) => sum + w.weeklyTimeLoss, 0),
                    desperdicios_criticos: wasteItems.filter(w => w.priority === 'high').length
                }
            };
            
            console.log('üì° Enviando datos al Puente de Mando Kairux:', kairuxData);
            showNotification('üì° Datos enviados al Puente de Mando Kairux exitosamente', 'success');
        }

        function generateWasteReport() {
            showNotification('üìÑ Reporte de desperdicios generado exitosamente', 'success');
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 1rem 1.5rem;
                background: ${type === 'success' ? 'var(--success)' : type === 'error' ? 'var(--danger)' : 'var(--info)'};
                color: white;
                border-radius: 10px;
                box-shadow: var(--shadow-lg);
                z-index: 1000;
                font-weight: 600;
                max-width: 400px;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        document.querySelectorAll('.matrix-quadrant').forEach(quadrant => {
            quadrant.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
            });
            
            quadrant.addEventListener('drop', (e) => {
                e.preventDefault();
                const wasteId = parseInt(e.dataTransfer.getData('text/plain'));
                const waste = wasteItems.find(w => w.id === wasteId);
                
                if (waste) {
                    const newQuadrant = quadrant.id.replace('quadrant-', '');
                    waste.quadrant = newQuadrant;
                    
                    if (newQuadrant === 'high-high') waste.priority = 'high';
                    else if (newQuadrant === 'low-low') waste.priority = 'low';
                    else waste.priority = 'medium';
                    
                    const wasteCard = document.getElementById(`waste-${wasteId}`);
                    quadrant.appendChild(wasteCard);
                    
                    showNotification(`üîÑ Desperdicio reclasificado como prioridad ${waste.priority.toUpperCase()}`, 'info');
                }
            });
        });

        setInterval(() => {
            if (wasteItems.length > 0) {
                localStorage.setItem('kairux_desperdicios', JSON.stringify(wasteItems));
            }
        }, 30000);

        window.addEventListener('load', function() {
            const savedWastes = localStorage.getItem('kairux_desperdicios');
            if (savedWastes) {
                try {
                    const parsedWastes = JSON.parse(savedWastes);
                    parsedWastes.forEach(waste => {
                        wasteItems.push(waste);
                        createWasteCard(waste);
                    });
                    updateStatistics();
                    showNotification('üìÇ Desperdicios previos cargados autom√°ticamente', 'info');
                } catch (error) {
                    console.error('Error cargando desperdicios:', error);
                }
            }
        });
    </script>
</body>
</html>